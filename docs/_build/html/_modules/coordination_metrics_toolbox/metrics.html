

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>coordination_metrics_toolbox.metrics &mdash; CoordinationMetricsToolbox 00.01 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=87ba083d"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            CoordinationMetricsToolbox
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">coordination_metrics_toolbox</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CoordinationMetricsToolbox</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">coordination_metrics_toolbox.metrics</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for coordination_metrics_toolbox.metrics</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">fastdtw</span> <span class="kn">import</span> <span class="n">fastdtw</span>

<div class="viewcode-block" id="generate_palette">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.generate_palette">[docs]</a>
<span class="k">def</span> <span class="nf">generate_palette</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a color palette with `n` colors using the &#39;viridis&#39; colormap.</span>

<span class="sd">    Parameters</span>
<span class="sd">        n : int</span>
<span class="sd">            The number of colors to generate.</span>

<span class="sd">    Returns</span>
<span class="sd">        colors : list</span>
<span class="sd">            A list of RGBA color tuples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">colors</span></div>


<div class="viewcode-block" id="get_pca_frame">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.get_pca_frame">[docs]</a>
<span class="k">def</span> <span class="nf">get_pca_frame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform Principal Component Analysis (PCA) on the given data and return the PCA frame.</span>

<span class="sd">    Parameters</span>
<span class="sd">        data : array-like, shape (n_samples, n_features)</span>
<span class="sd">            The input data to perform PCA on.</span>
<span class="sd">        n_components : int, optional, default=2</span>
<span class="sd">            The number of principal components to compute.</span>

<span class="sd">    Returns</span>
<span class="sd">        components : array, shape (n_components, n_features)</span>
<span class="sd">            The principal components of the data.</span>
<span class="sd">        explained_variance_ratio : array, shape (n_components,)</span>
<span class="sd">            The amount of variance explained by each of the selected components.</span>

<span class="sd">    Notes</span>
<span class="sd">        The function normalizes the data by subtracting the mean before performing PCA.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data_norm</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span>
    <span class="n">pca_data</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># pca.components_[0,:] contains the first vector of the PCA frame</span>
    <span class="c1"># pca.components_[1,:] contains the second vector of the PCA frame</span>

    <span class="n">components</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span>
    <span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
    <span class="k">return</span> <span class="n">components</span><span class="p">,</span> <span class="n">explained_variance_ratio</span></div>





<div class="viewcode-block" id="CoordinationMetrics">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics">[docs]</a>
<span class="k">class</span> <span class="nc">CoordinationMetrics</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class provides a toolbox for computing various coordination metrics from joint angle data. </span>

<span class="sd">    It includes methods for loading data, setting angle names, computing velocities, and various </span>
<span class="sd">    coordination metrics such as continuous relative phase, principal component analysis, </span>
<span class="sd">    cross-correlation, and more.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    list_files_angles : list</span>
<span class="sd">        List of file paths to the CSV files containing joint angle data.</span>
<span class="sd">    list_name_angles : list </span>
<span class="sd">        List of names corresponding to the angles.</span>
<span class="sd">    name : str  </span>
<span class="sd">        Name of the dataset instance.</span>
<span class="sd">    end_effector : bool</span>
<span class="sd">        Flag indicating if the data contains end-effector data.</span>
<span class="sd">    deg : bool</span>
<span class="sd">        Flag indicating if the angles are in degrees.</span>
<span class="sd">    freq : float</span>
<span class="sd">        Frequency of the data.</span>
<span class="sd">    data_joints_angles : list</span>
<span class="sd">        List of pandas DataFrames containing joint angle data.</span>
<span class="sd">    list_name_velocities : list</span>
<span class="sd">        List of names of the velocities of the angles.</span>
<span class="sd">    angles_combinations : list</span>
<span class="sd">        List of all possible combinations of angles.</span>
<span class="sd">    n_dof : int</span>
<span class="sd">        Number of degrees of freedom.</span>
<span class="sd">        </span>
<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    load_csv_files()</span>
<span class="sd">        Loads joint angle data from a list of CSV files.</span>
<span class="sd">    set_angle_names()</span>
<span class="sd">        Sets the names of the angles based on the data provided.</span>
<span class="sd">    set_velocities_names()</span>
<span class="sd">        Sets the names of the velocities of the angles.</span>
<span class="sd">    set_angles_combinations()</span>
<span class="sd">        Sets the combinations of angles for computing inter-joint coordination metrics.</span>
<span class="sd">    rename_time_column()</span>
<span class="sd">        Renames the first column of each DataFrame in the `data_joints_angles` attribute to &quot;time&quot;.</span>
<span class="sd">    rename_end_effector_columns()</span>
<span class="sd">        Renames the columns of the end-effector data.</span>
<span class="sd">    compute_end_effector_velocity()</span>
<span class="sd">        Computes the velocity of the end-effector data.</span>
<span class="sd">    set_n_dof()</span>
<span class="sd">        Sets the number of degrees of freedom (n_dof) for the object.</span>
<span class="sd">    convert_angles_to_radians()</span>
<span class="sd">        Converts the joint angles from degrees to radians.</span>
<span class="sd">    compute_joints_angular_velocity()</span>
<span class="sd">        Computes the angular velocity for each joint angle in the dataset.</span>
<span class="sd">    plot_joints_angles(trial=None)</span>
<span class="sd">        Plots the joint angles for the specified trial, all trials, or mean trial.</span>
<span class="sd">    plot_joints_angular_velocity(trial=None)</span>
<span class="sd">        Plots the joint angular velocities for the specified trial.</span>
<span class="sd">    compute_continuous_relative_phase(trial=None, plot=False)   </span>
<span class="sd">        Compute the Continuous Relative Phase (CRP) for joint angles.</span>
<span class="sd">    compute_angle_angle_plot(trial=None)</span>
<span class="sd">        Generates an angle-angle plot for joint angles data.</span>
<span class="sd">    compute_principal_component_analysis(trial=None, plot=False, n_components=2)</span>
<span class="sd">        Compute Principal Component Analysis (PCA) on joint angle data.</span>
<span class="sd">    compute_cross_correlation(trial=None, plot=False, normalize=False)</span>
<span class="sd">        Compute the cross-correlation between joint angles for a given trial or all trials.</span>
<span class="sd">    compute_interjoint_coupling_interval(trial=None, plot=False)</span>
<span class="sd">        Computes the Interjoint Coupling Interval (ICI) for the given trial or all trials.</span>
<span class="sd">    get_pca_subspace(n_components=None)</span>
<span class="sd">        Computes the PCA (Principal Component Analysis) subspace for the given data.</span>
<span class="sd">    </span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; list_files_angles = [&quot;data/angles1.csv&quot;, &quot;data/angles2.csv&quot;]</span>
<span class="sd">    &gt;&gt;&gt; list_name_angles = [&quot;angle1&quot;, &quot;angle2&quot;, &quot;angle3&quot;]</span>
<span class="sd">    &gt;&gt;&gt; m = CoordinationMetrics(list_files_angles, list_name_angles, &quot;Test Data&quot;, end_effector = False, deg=False)</span>
<span class="sd">    &gt;&gt;&gt; m.compute_continuous_relative_phase(trial=4, plot=True)  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    

<div class="viewcode-block" id="CoordinationMetrics.__init__">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_files_angles</span><span class="p">,</span> <span class="n">list_name_angles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_effector</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="n">deg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the CoordinationMetrics object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        list_files_angles : list</span>
<span class="sd">            List of file paths to the CSV files containing joint angle data.</span>
<span class="sd">        list_name_angles : list, optional</span>
<span class="sd">            List of names corresponding to the angles. Defaults to None.</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            Name of the dataset instance. Defaults to None.</span>
<span class="sd">        end_effector : bool, optional</span>
<span class="sd">            Flag indicating if the data contains end-effector data. Defaults to False.</span>
<span class="sd">        deg : bool, optional</span>
<span class="sd">            Flag indicating if the angles are in degrees. Defaults to True.</span>
<span class="sd">        freq : float, optional</span>
<span class="sd">            Frequency of the data. Defaults to None.</span>

<span class="sd">        Returns</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">list_files_angles</span> <span class="o">=</span> <span class="n">list_files_angles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span> <span class="o">=</span> <span class="n">list_name_angles</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Default name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Dataset&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_effector</span> <span class="o">=</span> <span class="n">end_effector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deg</span> <span class="o">=</span> <span class="n">deg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>

        <span class="c1"># Load data and initialize fields correctly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_csv_files</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_angle_names</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_velocities_names</span><span class="p">()</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">set_angles_combinations</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rename_time_column</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_n_dof</span><span class="p">()</span>

        <span class="c1"># Convert angles to radians if necessary</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">deg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_angles_to_radians</span><span class="p">()</span>

        <span class="c1"># If end effector is provided, rename columns and compute velocity</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_effector</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rename_end_effector_columns</span><span class="p">()</span>  
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_end_effector_velocity</span><span class="p">()</span>

        <span class="c1"># Compute angular velocity of the joints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_joints_angular_velocity</span><span class="p">()</span>  

        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="CoordinationMetrics.load_csv_files">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.load_csv_files">[docs]</a>
    <span class="k">def</span> <span class="nf">load_csv_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads joint angle data from a list of CSV files.</span>

<span class="sd">        This method reads CSV files specified in `self.list_files_angles` and </span>
<span class="sd">        stores the data in `self.data_joints_angles`. Each file is expected to </span>
<span class="sd">        have a header row.</span>

<span class="sd">        Raises:</span>
<span class="sd">            FileNotFoundError: If any file in `self.list_files_angles` does not exist.</span>
<span class="sd">            ValueError: If any file in `self.list_files_angles` is not a CSV file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create an empty list to store the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Load the data from each file</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_files_angles</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2"> is not a CSV file.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>




<div class="viewcode-block" id="CoordinationMetrics.set_angle_names">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.set_angle_names">[docs]</a>
    <span class="k">def</span> <span class="nf">set_angle_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the names of the angles based on the data provided.</span>

<span class="sd">        This method assigns the list of angle names to the `list_name_angles` attribute.</span>
<span class="sd">        If `list_name_angles` is None and `end_effector` is False, it sets `list_name_angles`</span>
<span class="sd">        to all columns of `data_joints_angles[0]` except the first one.</span>
<span class="sd">        If `list_name_angles` is None and `end_effector` is True, it sets `list_name_angles`</span>
<span class="sd">        to all columns of `data_joints_angles[0]` except the first one and the last three.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            list_name_angles : list </span>
<span class="sd">                The list of angle names.</span>
<span class="sd">            data_joints_angles : list</span>
<span class="sd">                A list containing data frames with joint angles.</span>
<span class="sd">            end_effector : bool</span>
<span class="sd">                A flag indicating whether the end effector is considered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_effector</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_effector</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span> <span class="o">-</span><span class="mi">3</span><span class="p">]</span></div>


<div class="viewcode-block" id="CoordinationMetrics.set_velocities_names">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.set_velocities_names">[docs]</a>
    <span class="k">def</span> <span class="nf">set_velocities_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the names of the velocities of the angles.</span>
<span class="sd">        This method sets the names of the velocities of the angles by appending &quot;_velocity&quot;</span>
<span class="sd">        to the names of the angles.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            list_name_angles (list): A list containing the names of the angles.</span>
<span class="sd">            list_name_velocities (list): A list containing the names of the velocities of the angles.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">list_name_velocities</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">_velocity&quot;</span> <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">]</span></div>


<div class="viewcode-block" id="CoordinationMetrics.set_angles_combinations">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.set_angles_combinations">[docs]</a>
    <span class="k">def</span> <span class="nf">set_angles_combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the combinations of angles for computing inter-joint coordination metrics.</span>
<span class="sd">        This method generates all possible combinations of angles from the list of angle names</span>
<span class="sd">        and stores them in the `angles_combinations` attribute.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            list_name_angles (list): A list containing the names of the angles.</span>
<span class="sd">            angles_combinations (list): A list containing all possible combinations of angles.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">angles_combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span></div>


<div class="viewcode-block" id="CoordinationMetrics.rename_time_column">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.rename_time_column">[docs]</a>
    <span class="k">def</span> <span class="nf">rename_time_column</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Renames the first column of each DataFrame in the `data_joints_angles` attribute to &quot;time&quot;.</span>

<span class="sd">        This method iterates over the list of DataFrames stored in the `data_joints_angles` attribute</span>
<span class="sd">        and renames the first column of each DataFrame to &quot;time&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s2">&quot;time&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="CoordinationMetrics.rename_end_effector_columns">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.rename_end_effector_columns">[docs]</a>
    <span class="k">def</span> <span class="nf">rename_end_effector_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Renames the columns of the end-effector data.</span>

<span class="sd">        This method renames the columns of the end-effector data to &quot;ee_x&quot;, &quot;ee_y&quot;, and &quot;ee_z&quot;.</span>
<span class="sd">        The function iterates over all dataframes containing joints angles.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">:</span>
            <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]:</span> <span class="s2">&quot;ee_x&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]:</span> <span class="s2">&quot;ee_y&quot;</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span> <span class="s2">&quot;ee_z&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="CoordinationMetrics.compute_end_effector_velocity">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_end_effector_velocity">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_end_effector_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the velocity of the end-effector data.</span>

<span class="sd">        This method computes the velocity of the end-effector data by taking the derivative of the</span>
<span class="sd">        &quot;ee_x&quot;, &quot;ee_y&quot;, and &quot;ee_z&quot; columns. The velocity is stored in the &quot;ee_x_velocity&quot;,</span>
<span class="sd">        &quot;ee_y_velocity&quot;, and &quot;ee_z_velocity&quot; columns. The global end-effector velocity is also computed</span>
<span class="sd">        and stored in the &quot;ee_velocity&quot; column. </span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">vel_col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s2">&quot;ee_x&quot;</span><span class="p">,</span> <span class="s2">&quot;ee_y&quot;</span><span class="p">,</span> <span class="s2">&quot;ee_z&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;ee_x_velocity&quot;</span><span class="p">,</span> <span class="s2">&quot;ee_y_velocity&quot;</span><span class="p">,</span> <span class="s2">&quot;ee_z_velocity&quot;</span><span class="p">]):</span>
                <span class="n">df</span><span class="p">[</span><span class="n">vel_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;ee_velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;ee_x_velocity&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;ee_y_velocity&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;ee_z_velocity&quot;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="CoordinationMetrics.set_n_dof">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.set_n_dof">[docs]</a>
    <span class="k">def</span> <span class="nf">set_n_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the number of degrees of freedom (n_dof) for the object.</span>
<span class="sd">        This method calculates the number of degrees of freedom by determining the length of the </span>
<span class="sd">        list_name_angles attribute and assigns this value to the n_dof attribute.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            n_dof (int): The number of degrees of freedom.</span>
<span class="sd">            list_name_angles (list): A list containing the names of the angles.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_dof</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)</span></div>


<div class="viewcode-block" id="CoordinationMetrics.convert_angles_to_radians">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.convert_angles_to_radians">[docs]</a>
    <span class="k">def</span> <span class="nf">convert_angles_to_radians</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the joint angles from degrees to radians.</span>

<span class="sd">        This method converts the joint angles from degrees to radians by multiplying the values</span>
<span class="sd">        in the `data_joints_angles` attribute by the conversion factor pi/180.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            data_joints_angles (list of DataFrames): A list containing DataFrames with joint angle data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">)</span></div>



<span class="c1">#%% Compute angular velocity of the joints</span>

<div class="viewcode-block" id="CoordinationMetrics.compute_joints_angular_velocity">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_joints_angular_velocity">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_joints_angular_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the angular velocity for each joint angle in the dataset.</span>

<span class="sd">        This method calculates the angular velocity for each joint angle by taking the difference</span>
<span class="sd">        between consecutive angle values and dividing by the time difference. The resulting angular</span>
<span class="sd">        velocities are stored in new columns with the suffix &#39;_velocity&#39;.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">            &quot;&quot;&quot;</span>
        

        <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">vel_col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_velocities</span><span class="p">):</span>
                <span class="n">df</span><span class="p">[</span><span class="n">vel_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span></div>



    <span class="c1">#%% Plotting functions</span>

<div class="viewcode-block" id="CoordinationMetrics.plot_joints_angles">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.plot_joints_angles">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_joints_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the joint angles for the specified trial, all trials, or mean trial.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            trial (int, optional): The index of the trial to plot. If None, plots all trials. If -1, plots the mean of all trials. Defaults to None.</span>
<span class="sd">            </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the trial index is out of range.</span>
<span class="sd">            The plot will display the joint angles over time for the specified trial(s).</span>
<span class="sd">            The x-axis represents time, and the y-axis represents the joint angles.</span>
<span class="sd">            The y-axis label will indicate whether the angles are in degrees or radians.</span>
<span class="sd">            The plot title will include the name of the trial(s) and, if available, the name of the dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        

        <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;All trials&quot;</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span> <span class="ow">or</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial index </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> out of range. Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> trials available.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mean_data</span><span class="p">()]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mean of all trials&quot;</span>
        <span class="k">else</span> <span class="p">:</span> 
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="n">trial</span><span class="p">]]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">generate_palette</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_dof</span><span class="p">)</span>
        <span class="c1">#plot all trials</span>
        <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">):</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">angle</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Angle (degrees)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Angle (radians)&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Joint angles for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Joint angles </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>    
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="CoordinationMetrics.plot_joints_angular_velocity">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.plot_joints_angular_velocity">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_joints_angular_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>    
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the joint angular velocities for the specified trial.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            trial (int): The index of the trial to plot. If None, plots all trials. If -1  plots the mean of all trials.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the trial index is out of range.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;All trials&quot;</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span> <span class="ow">or</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial index </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> out of range. Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> trials available.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mean_data</span><span class="p">()]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mean of all trials&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="n">trial</span><span class="p">]]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">generate_palette</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_dof</span><span class="p">)</span>
        <span class="c1"># plot all trials</span>
        <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">):</span>
                <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">_velocity&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">deg</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Angular Velocity (degrees/s)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Angular Velocity (radians/s)&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Joint angular velocities </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="c1">#%% Inter-joint coordination metrics</span>

<div class="viewcode-block" id="CoordinationMetrics.compute_continuous_relative_phase">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_continuous_relative_phase">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_continuous_relative_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the Continuous Relative Phase (CRP) for joint angles.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            trial : int, optional</span>
<span class="sd">                Index of the trial to compute the CRP for. If None, computes CRP for all trials.</span>
<span class="sd">                If -1, computes CRP for the mean of all trials. Default is None.</span>
<span class="sd">            plot : bool, optional</span>
<span class="sd">            If True, plots the CRP for the specified trial(s). Default is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            data : list of pandas.DataFrame</span>
<span class="sd">                List of DataFrames containing the joint angles and their computed phases, </span>
<span class="sd">                as well as the CRP for the specified trial(s).</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError</span>
<span class="sd">                If the specified trial index is out of range.</span>

<span class="sd">        Notes:</span>
<span class="sd">            The function computes the phase for each joint using the arctangent of the </span>
<span class="sd">            joint angle velocity and the joint angle. It then computes the CRP between </span>
<span class="sd">            specified pairs of joints (angles_combinations) by unwrapping the difference </span>
<span class="sd">            between their phases. If plotting is enabled, it generates plots of the CRP </span>
<span class="sd">            over time for the specified trial(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        

        <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;All trials&quot;</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span> <span class="ow">or</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial index </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> out of range. Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> trials available.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mean_data</span><span class="p">()]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mean of all trials&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="n">trial</span><span class="p">]]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2">&quot;</span>    
        <span class="c1">#compute the phase for each joint</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">angle</span><span class="p">,</span> <span class="n">angle_vel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_velocities</span><span class="p">):</span>
                <span class="n">d</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">angle</span><span class="si">}</span><span class="s2">_phase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">angle_vel</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="n">angle</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles_combinations</span><span class="p">:</span>
                <span class="c1">#create column and fill with NaN</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;CRP_&#39;</span><span class="o">+</span><span class="n">a1</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">a2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
                <span class="c1">#compute relative phase, without considering the first row that is NaN</span>
                <span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="s1">&#39;CRP_&#39;</span><span class="o">+</span><span class="n">a1</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">a2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="n">a1</span><span class="o">+</span><span class="s1">&#39;_phase&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="n">a2</span><span class="o">+</span><span class="s1">&#39;_phase&#39;</span><span class="p">])</span>

        <span class="c1">#plot the CRP</span>
        <span class="k">if</span> <span class="n">plot</span> <span class="p">:</span>      
            <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles_combinations</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;CRP_&#39;</span><span class="o">+</span><span class="n">a1</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">a2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Trial &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Continuous Relative Phase &#39;</span><span class="o">+</span><span class="n">a1</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">a2</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;CRP (radians)&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span></div>



<div class="viewcode-block" id="CoordinationMetrics.compute_angle_angle_plot">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_angle_angle_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_angle_angle_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates an angle-angle plot for joint angles data.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            trial (int, optional): The index of the trial to plot. If None, all trials are concatenated and plotted.</span>
<span class="sd">                        If -1, the mean of all trials is plotted. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: The data used for plotting.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the trial index is out of range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_concatenate_data</span><span class="p">()</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;All trials&quot;</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span> <span class="ow">or</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial index </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> out of range. Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> trials available.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trial</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_data</span><span class="p">()</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mean of all trials&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">a</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">vars</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">corner</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">diag_kind</span><span class="o">=</span><span class="s1">&#39;kde&#39;</span><span class="p">,</span> <span class="n">plot_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span><span class="mf">0.5</span><span class="p">})</span>
        <span class="n">a</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Angle-Angle plot </span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>  
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
        <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="CoordinationMetrics.compute_principal_component_analysis">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_principal_component_analysis">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_principal_component_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Principal Component Analysis (PCA) on joint angle data.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            trial : int, optional</span>
<span class="sd">                Index of the trial to analyze. If None, all trials are concatenated.</span>
<span class="sd">                If -1, the mean of all trials is used. Default is None.</span>
<span class="sd">            plot : bool, optional</span>
<span class="sd">                If True, plots the PCA components. Default is False.</span>
<span class="sd">            n_components : int, optional</span>
<span class="sd">                Number of principal components to compute. Default is 2.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pca : PCA object</span>
<span class="sd">                Fitted PCA object containing the principal components.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError</span>
<span class="sd">                If the trial index is out of range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_concatenate_data</span><span class="p">()</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;All trials&quot;</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span> <span class="ow">or</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial index </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> out of range. Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> trials available.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_data</span><span class="p">()</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mean of all trials&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="n">trial</span><span class="p">]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="c1">#standardize the data</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
        <span class="n">data_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1">#compute the PCA for each joint</span>
        <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span>
        <span class="n">pca</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">])</span>

        <span class="c1">#plot the PCA</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>      
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">n_components</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">n_components</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>   
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_components</span><span class="p">):</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">,</span> <span class="n">pca</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Principal Component </span><span class="si">{</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
        <span class="k">return</span> <span class="n">pca</span></div>


<div class="viewcode-block" id="CoordinationMetrics.compute_cross_correlation">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_cross_correlation">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_cross_correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the cross-correlation between joint angles for a given trial or all trials.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            trial : int, optional </span>
<span class="sd">                Index of the trial to compute cross-correlation for. If None, computes for all trials. If -1, computes for the mean of all trials.  Defaults to None.</span>
<span class="sd">            plot : bool, optional</span>
<span class="sd">                If True, plots the cross-correlation results. Defaults to False.</span>
<span class="sd">            normalize : bool, optional</span>
<span class="sd">                If True, normalizes the data before computing cross-correlation. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            data : list</span>
<span class="sd">                A list of DataFrames containing the cross-correlation results for each trial.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the trial index is out of range.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_joints_angles</span><span class="p">()</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;All trials&quot;</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span> <span class="ow">or</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial index </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> out of range. Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> trials available.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mean_data</span><span class="p">()]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mean of all trials&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="n">trial</span><span class="p">]]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Normalize the data</span>
        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">:</span>
                    <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles_combinations</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="c1">#create column and fill with NaN</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;CrossCorr_&#39;</span><span class="o">+</span><span class="n">a1</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">a2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
                <span class="c1">#compute cross-correlation</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;CrossCorr_&#39;</span><span class="o">+</span><span class="n">a1</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">a2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">correlate</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">a1</span><span class="p">],</span><span class="n">d</span><span class="p">[</span><span class="n">a2</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;CrossCorr_Lag&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles_combinations</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;CrossCorr_Lag&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;CrossCorr_&#39;</span><span class="o">+</span><span class="n">a1</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">a2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Trial &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cross-correlation </span><span class="si">{</span><span class="n">a1</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">a2</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Lag Step&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cross-correlation&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">data</span></div>

    
<div class="viewcode-block" id="CoordinationMetrics.compute_interjoint_coupling_interval">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_interjoint_coupling_interval">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_interjoint_coupling_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the Interjoint Coupling Interval (ICI) for the given trial or all trials.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            trial : int, optional</span>
<span class="sd">                The index of the trial to compute the ICI for. If None, computes the ICI for all trials.</span>
<span class="sd">                If -1, computes the ICI for the mean of all trials. Default is None.</span>
<span class="sd">            plot : bool, optional</span>
<span class="sd">                If True, plots the ICI results using a bar plot. Default is False.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame</span>
<span class="sd">                A DataFrame containing the ICI results with columns &#39;trial&#39;, &#39;joints&#39;, and &#39;ICI&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError</span>
<span class="sd">                If the trial index is out of range.</span>
<span class="sd">        </span>
<span class="sd">        Notes:</span>
<span class="sd">            The ICI is computed as the difference in deactivation times between two joints.</span>
<span class="sd">            The deactivation time is defined as the first element of the last block of consecutive indices</span>
<span class="sd">            where the joint&#39;s velocity is less than 5% of its maximum velocity.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_joints_angles</span><span class="p">()</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;All trials&quot;</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span> <span class="ow">or</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial index </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> out of range. Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> trials available.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mean_data</span><span class="p">()]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mean of all trials&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="n">trial</span><span class="p">]]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="c1"># Create an empty confusion matrix with the joint angles as columns and rows</span>
        <span class="n">ici_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="s1">&#39;ICI&#39;</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">ici_results</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles_combinations</span><span class="p">:</span>
                <span class="c1">#compute ICI</span>
                <span class="n">end_of_movement1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[(</span><span class="n">d</span><span class="p">[</span><span class="n">a1</span><span class="o">+</span><span class="s1">&#39;_velocity&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="n">a1</span><span class="o">+</span><span class="s1">&#39;_velocity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())]</span>
                <span class="n">end_of_movement2</span> <span class="o">=</span> <span class="n">d</span><span class="p">[(</span><span class="n">d</span><span class="p">[</span><span class="n">a2</span><span class="o">+</span><span class="s1">&#39;_velocity&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="n">a2</span><span class="o">+</span><span class="s1">&#39;_velocity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())]</span>

                <span class="c1"># Find the intervals where the indices are consecutive and selet the last block for the end of the movement</span>
                <span class="c1">#Then select the first element of the last block as the deactivation time of the joint</span>
                <span class="n">end_of_movement1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">end_of_movement1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">end_of_movement1</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">end_of_movement2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">end_of_movement2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">end_of_movement2</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

                <span class="c1">#Compute the ICI</span>
                <span class="n">ici_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">ici_results</span><span class="p">)]</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;trial&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;joints&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a1</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">a2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;ICI&#39;</span><span class="p">:</span> <span class="n">end_of_movement2</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">end_of_movement1</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>

                
            <span class="nb">print</span><span class="p">(</span><span class="n">ici_results</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">ici_results</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;ICI&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Interjoint Coupling Interval </span><span class="si">{</span><span class="n">a1</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">a2</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;ICI&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ici_results</span></div>

    
<div class="viewcode-block" id="CoordinationMetrics.get_pca_subspace">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.get_pca_subspace">[docs]</a>
    <span class="k">def</span> <span class="nf">get_pca_subspace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_components</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the PCA (Principal Component Analysis) subspace for the given data.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            n_components (int, optional): Number of principal components to keep. </span>
<span class="sd">                If None, the number of components will be set to the number of degrees of freedom (self.n_dof).</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A DataFrame containing the PCA-transformed data with the specified number of components.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        
        <span class="k">if</span> <span class="n">n_components</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_dof</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_concatenate_data</span><span class="p">()</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
        <span class="n">data_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">get_pca_frame</span><span class="p">(</span><span class="n">data_scaled</span><span class="p">,</span> <span class="n">n_components</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="CoordinationMetrics.compute_distance_between_PCs">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_distance_between_PCs">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_distance_between_PCs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cm2</span><span class="p">,</span> <span class="n">n_components</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the distance between the principal components (PCs) of the joint angles.</span>
<span class="sd">        </span>
<span class="sd">        From Bockemühl Till, Troje NF, Dürr V. Inter‑joint coupling and joint angle synergies of human catching movements. Hum Mov Sci. 2010;29(1):73–93.</span>
<span class="sd">        https:// doi. org/ 10. 1016/j. humov. 2009. 03. 003.</span>
<span class="sd">        Distance between PCs is defined as dist(U, V ) = np.sqrt(1 − s^2), with s being the minimum singular value of the matrix W = min(U^T V ).</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            cm2 : CoordinationMetrics</span>
<span class="sd">                The CoordinationMetrics object to compare the distance between PCs with.</span>
<span class="sd">            trial : int</span>
<span class="sd">                The index of the trial to compute the distance between PCs for. Default is None and uses all the data. If -1, uses the mean joints data</span>
<span class="sd">            plot : bool</span>
<span class="sd">                Flag to indicate whether to plot the distance between PCs. Default is False.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the trial index is out of range.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            res_dist_pca: A dataframe containing the distance between PCs for each pair of joints, one row per trial.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Compute PCA on both datasets that will define U and V</span>
        <span class="n">res_dist_pca</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;datasetA&#39;</span><span class="p">,</span> <span class="s1">&#39;datasetB&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">,</span> <span class="s1">&#39;angle&#39;</span><span class="p">])</span>
        <span class="n">subspaceA</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pca_subspace</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span> <span class="c1"># U</span>
        <span class="n">subspaceB</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cm2</span><span class="o">.</span><span class="n">get_pca_subspace</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span> <span class="c1"># V</span>

        <span class="n">U</span> <span class="o">=</span> <span class="n">subspaceA</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">subspaceB</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">subspaceA</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">subspaceB</span><span class="p">)</span>

        <span class="c1"># Verify dimension subspaces</span>
        <span class="k">if</span> <span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">U</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Singular value decomposition of the matrix U^T V</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">svd</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">U</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">V</span><span class="p">),</span> <span class="n">compute_uv</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Compute the minimum of SVD</span>
        <span class="n">Smin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>

        <span class="c1"># Compute the distance</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Smin</span> <span class="o">*</span> <span class="n">Smin</span><span class="p">))</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="mi">180</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>       
        
        <span class="n">res_dist_pca</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">res_dist_pca</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;datasetA&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="s1">&#39;datasetB&#39;</span><span class="p">:</span> <span class="n">cm2</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="s1">&#39;distance&#39;</span><span class="p">:</span> <span class="n">d</span><span class="p">,</span> <span class="s1">&#39;angle&#39;</span><span class="p">:</span> <span class="n">angle</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">res_dist_pca</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;datasetA&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;distance&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Distance between PCs&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>   
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Datasets&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Distance&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


        <span class="k">return</span> <span class="n">res_dist_pca</span></div>


        
<div class="viewcode-block" id="CoordinationMetrics.compute_correlation">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_correlation">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the correlation between joint angles for a given trial or all trials.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            trial : int, optional</span>
<span class="sd">                The index of the trial to compute the correlation for. If None, computes the correlation for all trials.</span>
<span class="sd">                If -1, computes the correlation for the mean of all trials. Default is None.</span>
<span class="sd">            plot : bool, optional</span>
<span class="sd">                If True, plots the correlation results. Default is False.</span>
<span class="sd">            type : str, optional</span>
<span class="sd">                The type of correlation to compute. Options are &#39;pearson&#39;, &#39;kendall&#39;, or &#39;spearman&#39;. Default is &#39;pearson&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame</span>
<span class="sd">                A DataFrame containing the correlation results with columns [&#39;trial&#39;, &#39;joints&#39;, &#39;correlation&#39;].</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError</span>
<span class="sd">                If the trial index is out of range.</span>
<span class="sd">        </span>
<span class="sd">        Notes:</span>
<span class="sd">            The method computes the correlation between all combinations of joint angles specified in `self.angles_combinations`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_joints_angles</span><span class="p">()</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;All trials&quot;</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span> <span class="ow">or</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial index </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> out of range. Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> trials available.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mean_data</span><span class="p">()]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mean of all trials&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="n">trial</span><span class="p">]]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="c1"># Create an empty confusion matrix with the joint angles as columns and rows</span>
        <span class="n">correlation_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="s1">&#39;correlation&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles_combinations</span><span class="p">:</span>
                <span class="c1">#compute correlation</span>
                <span class="n">correlation_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">correlation_results</span><span class="p">)]</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;trial&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;joints&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a1</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">a2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;correlation&#39;</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">a1</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">a2</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="nb">type</span><span class="p">)})</span>

        <span class="k">if</span> <span class="n">plot</span> <span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">correlation_results</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;correlation&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Correlation </span><span class="si">{</span><span class="n">a1</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">a2</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Correlation&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">correlation_results</span></div>

    
<div class="viewcode-block" id="CoordinationMetrics.compute_angle_ratio">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_angle_ratio">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_angle_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the ratio of joint angles at the time of maximum end-effector velocity.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            trial : int, optional</span>
<span class="sd">                The index of the trial to compute the angle ratio for. If None, computes for all trials.</span>
<span class="sd">                If -1, computes for the mean of all trials. Default is None.</span>
<span class="sd">            plot : bool, optional</span>
<span class="sd">                If True, plots the angle ratios. Default is False.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame</span>
<span class="sd">                A DataFrame containing the trial index, joint pairs, and their corresponding angle ratios.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError</span>
<span class="sd">                If end-effector data is not available or if the trial index is out of range.</span>
<span class="sd">       </span>
<span class="sd">        Notes:</span>
<span class="sd">            The angle ratio is computed as the ratio of the angles of two joints at the time point where the end-effector velocity is maximum.</span>
<span class="sd">            If the angle of the second joint is zero, the ratio is set to NaN.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_effector</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This metric can only be computed if end-effector data is available.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_joints_angles</span><span class="p">()</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;All trials&quot;</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span> <span class="ow">or</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial index </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> out of range. Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> trials available.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mean_data</span><span class="p">()]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mean of all trials&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="n">trial</span><span class="p">]]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">angle_ratio_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="s1">&#39;angle_ratio&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">max_vel_time</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ee_velocity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles_combinations</span><span class="p">:</span>
                <span class="n">angle1</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_vel_time</span><span class="p">,</span> <span class="n">a1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">angle2</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">max_vel_time</span><span class="p">,</span> <span class="n">a2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">angle_ratio</span> <span class="o">=</span> <span class="n">angle1</span> <span class="o">/</span> <span class="n">angle2</span> <span class="k">if</span> <span class="n">angle2</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">angle_ratio_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">angle_ratio_results</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;trial&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;joints&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a1</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">a2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;angle_ratio&#39;</span><span class="p">:</span> <span class="n">angle_ratio</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">angle_ratio_results</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;angle_ratio&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Angle Ratio at Max Velocity Time Point </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Joint Pairs&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Angle Ratio&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">angle_ratio_results</span></div>

    
 
    
<div class="viewcode-block" id="CoordinationMetrics.compute_temporal_coordination_index">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_temporal_coordination_index">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_temporal_coordination_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the Temporal Coordination Index (TCI) for the given trial(s).</span>
<span class="sd">        This metric calculates the time difference between the start of the end-effector movement</span>
<span class="sd">        and the start of each joint&#39;s movement. The start of the movement is defined as the point</span>
<span class="sd">        where the velocity exceeds 5% of its maximum value.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            trial : int, optional</span>
<span class="sd">                The index of the trial to compute the TCI for. If None, computes TCI for all trials. If -1, computes TCI for the mean of all trials. Default is None.</span>
<span class="sd">            plot : bool, optional</span>
<span class="sd">                If True, plots the TCI results using a bar plot. Default is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tci_results : pandas.DataFrame</span>
<span class="sd">                A DataFrame containing the TCI results with columns &#39;trial&#39;, &#39;joints&#39;, and &#39;tci&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError</span>
<span class="sd">                If end-effector data is not available. If the trial index is out of range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_effector</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This metric can only be computed if end-effector data is available.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_joints_angles</span><span class="p">()</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;All trials&quot;</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span> <span class="ow">or</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial index </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> out of range. Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> trials available.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mean_data</span><span class="p">()]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mean of all trials&quot;</span>


        <span class="c1"># Create an empty confusion matrix with the joint angles as columns and rows    </span>
        <span class="n">tci_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="s1">&#39;tci&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">:</span>
            <span class="c1">#get start of the movement as 5% of the maximum velocity of the end-effector</span>
            <span class="n">start_of_movement1</span> <span class="o">=</span> <span class="n">d</span><span class="p">[(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ee_velocity&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ee_velocity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">:</span>
                <span class="c1">#find the start of joint movement as 5% of the maximum velocity of the joint</span>
                <span class="n">start_joint</span> <span class="o">=</span> <span class="n">d</span><span class="p">[(</span><span class="n">d</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="s1">&#39;_velocity&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="s1">&#39;_velocity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="c1">#Compute the TCI</span>
                <span class="n">tci_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tci_results</span><span class="p">)]</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;trial&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;joints&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;tci&#39;</span><span class="p">:</span> <span class="n">start_joint</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">start_of_movement1</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">tci_results</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;tci&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Temporal Coordination Index </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;TCI&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">tci_results</span></div>

    
<div class="viewcode-block" id="CoordinationMetrics.compute_zero_crossing">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_zero_crossing">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_zero_crossing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Compute the zero crossing time delay for joint angles.</span>
<span class="sd">            </span>
<span class="sd">            This method calculates the time delay between the start of movement and the </span>
<span class="sd">            deactivation time for each joint angle. The start of movement is defined as </span>
<span class="sd">            the time when the end-effector velocity exceeds 5% of its maximum value. The </span>
<span class="sd">            deactivation time for each joint is defined as the time when the joint&#39;s </span>
<span class="sd">            velocity drops below 5% of its maximum value.</span>

<span class="sd">            Parameters:</span>
<span class="sd">                trial : int, optional</span>
<span class="sd">                    The index of the trial to compute the zero crossing for. If None, computes for all trials. If -1, computes for the mean of all trials. Defaults to None.</span>
<span class="sd">                plot : bool, optional</span>
<span class="sd">                    If True, plots the zero crossing time delay for each joint. Defaults to False.</span>
<span class="sd">            </span>
<span class="sd">            Returns:</span>
<span class="sd">                pd.DataFrame: A DataFrame containing the zero crossing time delay for each joint </span>
<span class="sd">                          in each trial. The DataFrame has columns &#39;trial&#39;, &#39;joints&#39;, and </span>
<span class="sd">                          &#39;zero_crossing&#39;.</span>

<span class="sd">            Raises:</span>
<span class="sd">                ValueError: If end-effector data is not available or if the trial index is out of range.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_effector</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This metric can only be computed if end-effector data is available.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_joints_angles</span><span class="p">()</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;All trials&quot;</span>
            <span class="k">elif</span> <span class="n">trial</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span> <span class="ow">or</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial index </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> out of range. Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> trials available.&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">trial</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mean_data</span><span class="p">()]</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mean of all trials&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="n">trial</span><span class="p">]]</span>
                <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">zero_crossing_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="s1">&#39;zero_crossing&#39;</span><span class="p">])</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">start_of_movement</span> <span class="o">=</span> <span class="n">d</span><span class="p">[(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;ee_velocity&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ee_velocity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">:</span>
                    <span class="n">deactivation_time</span> <span class="o">=</span> <span class="n">d</span><span class="p">[(</span><span class="n">d</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1">_velocity&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1">_velocity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())][</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">zero_crossing_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">zero_crossing_results</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;trial&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;joints&#39;</span><span class="p">:</span> <span class="n">a</span><span class="p">,</span> <span class="s1">&#39;zero_crossing&#39;</span><span class="p">:</span> <span class="n">deactivation_time</span> <span class="o">-</span> <span class="n">start_of_movement</span><span class="p">}</span>

            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
                <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">zero_crossing_results</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;zero_crossing&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Zero Crossing Time Delay </span><span class="se">\n</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Joint&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Time Delay (s)&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">zero_crossing_results</span></div>

    
<div class="viewcode-block" id="CoordinationMetrics.compute_dynamic_time_warping">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_dynamic_time_warping">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_dynamic_time_warping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the Dynamic Time Warping (DTW) distance between joint angles for a given trial or all trials.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            trial : int, optional</span>
<span class="sd">                The index of the trial to compute DTW for. If None, computes DTW for all trials. If -1, computes DTW for the mean of all trials. Defaults to None.</span>
<span class="sd">            plot : bool, optional</span>
<span class="sd">                If True, plots the DTW results. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing the DTW results with columns &#39;trial&#39;, &#39;joints&#39;, and &#39;dtw&#39;.</span>
<span class="sd">        </span>
<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the trial index is out of range.</span>
<span class="sd">        </span>
<span class="sd">        Notes:</span>
<span class="sd">            - The DTW distance is computed for each combination of joint angles.</span>
<span class="sd">            - If plot is True, a bar plot of the DTW results is displayed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_joints_angles</span><span class="p">()</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;All trials&quot;</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span> <span class="ow">or</span> <span class="n">trial</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial index </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2"> out of range. Only </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="si">}</span><span class="s2"> trials available.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">trial</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mean_data</span><span class="p">()]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Mean of all trials&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">[</span><span class="n">trial</span><span class="p">]]</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="si">}</span><span class="s2">&quot;</span>
        
        <span class="c1"># Create an empty confusion matrix with the joint angles as columns and rows</span>
        <span class="n">dtw_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="s1">&#39;dtw&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles_combinations</span><span class="p">:</span>
                <span class="c1">#compute DTW</span>
                <span class="n">dtw_results</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">dtw_results</span><span class="p">)]</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;trial&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;joints&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a1</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">a2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;dtw&#39;</span><span class="p">:</span> <span class="n">fastdtw</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">a1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="n">a2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]})</span>

        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">dtw_results</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;joints&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;dtw&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dynamic Time Warping </span><span class="si">{</span><span class="n">a1</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">a2</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;DTW&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">dtw_results</span></div>

    
<div class="viewcode-block" id="CoordinationMetrics.compute_jcvpca">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_jcvpca">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_jcvpca</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord_metric</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_pca</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Joint Contribution Variation using PCA (JCVPCA).</span>

<span class="sd">        Parameters:</span>
<span class="sd">            coord_metric : object</span>
<span class="sd">                An object that provides the method `get_concatenate_data()` to retrieve the data for PCA.</span>
<span class="sd">            plot : bool, optional</span>
<span class="sd">                If True, the function will generate and display plots of the PCA results. Default is True.</span>
<span class="sd">            n_pca : int, optional</span>
<span class="sd">                Number of principal components to compute. If None, it defaults to the number of degrees of freedom (self.n_dof).</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            subspaceA : numpy.ndarray</span>
<span class="sd">                The PCA subspace of the reference dataset.</span>
<span class="sd">            res : numpy.ndarray</span>
<span class="sd">                The absolute values of the projection of the second dataset in the PCA subspace.</span>
<span class="sd">            sub : numpy.ndarray</span>
<span class="sd">                The difference between the absolute values of the PCA subspaces of the two datasets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        

        <span class="k">if</span> <span class="n">n_pca</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">n_pca</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_dof</span>

        <span class="c1"># 1) Compute PCA on datasetA, the reference </span>
        <span class="n">subspaceA</span><span class="p">,</span> <span class="n">varA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pca_subspace</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_pca</span><span class="p">)</span>

        <span class="c1"># 2) Project 2nd dataset in the PCA subspace</span>
        <span class="n">dataB</span> <span class="o">=</span> <span class="n">coord_metric</span><span class="o">.</span><span class="n">get_concatenate_data</span><span class="p">()</span>
        <span class="n">dataB_transformed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">dataB</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">subspaceA</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

       
        
        <span class="c1"># 3) Compute a PCA on these transformed data</span>

        <span class="n">subspaceB</span><span class="p">,</span> <span class="n">varB</span> <span class="o">=</span> <span class="n">get_pca_frame</span><span class="p">(</span><span class="n">dataB_transformed</span><span class="p">)</span>
   

        <span class="c1"># 4) Express depening on the joints</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">subspaceB</span><span class="p">,</span> <span class="n">subspaceA</span><span class="p">))</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">res</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">subspaceA</span><span class="p">)</span>

        <span class="c1"># 5) Compute the difference reported to the explained variance</span>
        <span class="n">res_prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sub</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">varA</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sub</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">varA</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>



        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Absolute values&#39;</span><span class="p">)</span>
    
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot; PC1 </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">varA</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot; PC2 </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">varA</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">coord_metric</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
   
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subspaceA</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])),</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">subspaceA</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]))</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)))</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subspaceA</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])),</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">subspaceA</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)))</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PC1&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">coord_metric</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])),</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)))</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PC2&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])),</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)))</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>

            <span class="c1"># print(res)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PC1&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Diff &#39;</span> <span class="o">+</span> <span class="n">coord_metric</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span> <span class="o">+</span>
                        <span class="s1">&#39;- &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])),</span> <span class="n">sub</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)))</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)</span>

            <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PC2&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])),</span> <span class="n">sub</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)))</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)</span>

            <span class="c1"># Create a list of strings that contains n times &#39;PC1_n&#39; and n times &#39;PC2_n&#39;</span>
            <span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;PC1_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;PC2_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">]</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">res_prop</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Difference reported to the explained variance&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>

            <span class="n">max_x</span> <span class="o">=</span><span class="n">max_y</span><span class="o">=</span> <span class="n">min_x</span><span class="o">=</span> <span class="n">min_y</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">axs</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
                <span class="n">lim_x</span><span class="p">,</span> <span class="n">lim_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()),</span> <span class="nb">max</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">lim_y</span> <span class="o">&gt;</span> <span class="n">max_y</span><span class="p">:</span>
                    <span class="n">max_y</span> <span class="o">=</span> <span class="n">lim_y</span>
                <span class="n">lim_x</span><span class="p">,</span> <span class="n">lim_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()),</span> <span class="nb">min</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">lim_y</span> <span class="o">&lt;</span> <span class="n">min_y</span><span class="p">:</span>
                    <span class="n">min_y</span> <span class="o">=</span> <span class="n">lim_y</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">(),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="n">min_y</span> <span class="o">-</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">max_y</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">))</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">subspaceA</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">sub</span></div>

    
<div class="viewcode-block" id="CoordinationMetrics.compute_jsvcrp">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.compute_jsvcrp">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_jsvcrp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord_metric</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the Joint Synchronization Variation based on Continuous Relative Phase (JSvCRP) between two datasets.</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">            coord_metric : object </span>
<span class="sd">                An object containing the second dataset with a method to compute continuous relative phase.</span>
<span class="sd">            plot :bool</span>
<span class="sd">                If True, a heatmap of the JSvCRP will be plotted. Default is False.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing the JSvCRP values for each pair of angles.</span>
<span class="sd">        </span>
<span class="sd">        Notes:</span>
<span class="sd">            - The method computes the Continuous Relative Phase (CRP) for both datasets.</span>
<span class="sd">            - The JSvCRP is calculated as the integral of the absolute difference between the CRP values of the two datasets.</span>
<span class="sd">            - The resulting JSvCRP values are stored in a DataFrame with angles as both rows and columns.</span>
<span class="sd">            - If `plot` is True, a heatmap of the JSvCRP values is displayed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        

        <span class="c1"># Compute the CRP for both datasets</span>
        <span class="n">crp1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_continuous_relative_phase</span><span class="p">()</span>
        <span class="n">crp2</span> <span class="o">=</span> <span class="n">coord_metric</span><span class="o">.</span><span class="n">compute_continuous_relative_phase</span><span class="p">()</span>
        
        <span class="n">crp1</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">crp1</span><span class="p">)</span>
        <span class="n">crp2</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">crp2</span><span class="p">)</span>

        
        <span class="c1"># Compute the JSvCRP</span>
        <span class="n">res_jsvcrp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles_combinations</span><span class="p">:</span>
            <span class="n">crp1_a</span> <span class="o">=</span> <span class="n">crp1</span><span class="p">[</span><span class="s1">&#39;CRP_&#39;</span><span class="o">+</span><span class="n">a1</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">a2</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
            <span class="n">crp2_a</span> <span class="o">=</span> <span class="n">crp2</span><span class="p">[</span><span class="s1">&#39;CRP_&#39;</span><span class="o">+</span><span class="n">a1</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">a2</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
            <span class="n">jsvcrp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">crp1_a</span> <span class="o">-</span> <span class="n">crp2_a</span><span class="p">))</span>
            <span class="n">res_jsvcrp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">]</span> <span class="o">=</span> <span class="n">jsvcrp</span>
            <span class="n">res_jsvcrp</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">a2</span><span class="p">,</span> <span class="n">a1</span><span class="p">]</span> <span class="o">=</span> <span class="n">jsvcrp</span>
        <span class="n">res_jsvcrp</span> <span class="o">=</span> <span class="n">res_jsvcrp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">res_jsvcrp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="c1"># Generate a mask for the upper triangle</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">res_jsvcrp</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">res_jsvcrp</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Joint Synchronization Variation based on Continuous Relative Phase&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Joint Pairs&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;JSvCRP&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">res_jsvcrp</span></div>


   
    <span class="c1">#%% Getter functions </span>

<div class="viewcode-block" id="CoordinationMetrics.get_data_joints_angles">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.get_data_joints_angles">[docs]</a>
    <span class="k">def</span> <span class="nf">get_data_joints_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter function for the data_joints_angles attribute.</span>

<span class="sd">        This function returns the data_joints_angles attribute.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of DataFrames containing joint angle data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span></div>


<div class="viewcode-block" id="CoordinationMetrics.get_n_dof">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.get_n_dof">[docs]</a>
    <span class="k">def</span> <span class="nf">get_n_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter function for the n_dof attribute.</span>

<span class="sd">        This function returns the n_dof attribute.</span>
<span class="sd">       </span>
<span class="sd">        Returns:</span>
<span class="sd">            int: The number of degrees of freedom.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_dof</span></div>

    
<div class="viewcode-block" id="CoordinationMetrics.get_name">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.get_name">[docs]</a>
    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter function for the name attribute.</span>

<span class="sd">        This function returns the name attribute.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The name of the dataset instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>


<div class="viewcode-block" id="CoordinationMetrics.get_list_name_angles">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.get_list_name_angles">[docs]</a>
    <span class="k">def</span> <span class="nf">get_list_name_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter function for the list_name_angles attribute.</span>

<span class="sd">        This function returns the list_name_angles attribute.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list containing the names of the angles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_angles</span></div>


<div class="viewcode-block" id="CoordinationMetrics.get_list_name_velocities">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.get_list_name_velocities">[docs]</a>
    <span class="k">def</span> <span class="nf">get_list_name_velocities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter function for the list_name_velocities attribute.</span>

<span class="sd">        This function returns the list_name_velocities attribute.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list containing the names of the velocities of the angles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_name_velocities</span></div>

    
<div class="viewcode-block" id="CoordinationMetrics.get_angles_combinations">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.get_angles_combinations">[docs]</a>
    <span class="k">def</span> <span class="nf">get_angles_combinations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Getter function for the angles_combinations attribute.</span>

<span class="sd">        This function returns the angles_combinations attribute.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list containing all possible combinations of angles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles_combinations</span> </div>

    
<div class="viewcode-block" id="CoordinationMetrics.get_mean_data">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.get_mean_data">[docs]</a>
    <span class="k">def</span> <span class="nf">get_mean_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the mean of the data for all trials.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A DataFrame containing the mean of the data for all trials.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="CoordinationMetrics.get_concatenate_data">
<a class="viewcode-back" href="../../coordination_metrics_toolbox.html#coordination_metrics_toolbox.CoordinationMetrics.get_concatenate_data">[docs]</a>
    <span class="k">def</span> <span class="nf">get_concatenate_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Concatenate all joints data in a single DataFrame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DataFrame: A DataFrame containing all joints data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_joints_angles</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Océane DUBOIS.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>